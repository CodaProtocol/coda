FROM gcr.io/o1labs-192920/ocaml-base:2eeb0f6460680af652d5c6b2b38fecf24df6a5b9

WORKDIR /app
ADD ./ /app
RUN sudo chown -R opam /app

RUN cd app/kademlia-haskell && . /home/opam/.nix-profile/etc/profile.d/nix.sh && nix-build release2.nix

RUN eval `opam config env` && jbuilder build

