(jbuild_version 1)

(library
 ((name nanobit)
  (modules (:standard \ (main_test_runner cli)))
  (library_flags (-linkall))
  (libraries (core nanobit_base camlsnark async async_extra))
  (preprocess (pps (ppx_jane ppx_inline_test ppx_driver.runner (-inline-test-lib nanobit))))
  (flags (-w -40 -g))
  )
 )

(executable
  ((name cli)
   (public_name cli)
   (modules (cli))
   (libraries (core async nanobit))
   (preprocess (pps (ppx_jane)))
   (flags (-w -40 -g))
   (modes (native))
  ))

(executable
  ((name main_test_runner)
   (modules (main_test_runner))
   (libraries (nanobit ppx_inline_test.runner.lib))))

(rule
 ((targets (keys.ml))
  (deps    (gen/genkeys.exe))
  (action  (run ${<} ${@}))))

(alias
  ((name runtest)
   (deps (main_test_runner.exe))
   (action (run ${<} inline-test-runner nanobit))))

